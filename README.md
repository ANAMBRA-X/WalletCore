# WalletCore API

## Overview
This project is a backend API service built with Node.js and the Express framework to interact with the Starknet blockchain. It provides core functionality for creating new Starknet accounts and pre-funding them with STRK tokens from a designated admin wallet.

## Features
- **Starknet.js**: For programmatic creation of Starknet accounts, address calculation, and on-chain transaction execution.
- **Express.js**: To build a clean, RESTful API server with defined routes for wallet operations.
- **AES-256-GCM Encryption**: For securely encrypting private keys using Node.js's native `crypto` module before they are returned to the client.

## Getting Started
### Installation
1.  Clone the repository:
    ```bash
    git clone https://github.com/your-username/walletcore.git
    ```
2.  Navigate to the project directory:
    ```bash
    cd walletcore
    ```
3.  Install dependencies:
    ```bash
    npm install
    ```
4.  Create a `.env` file in the root directory and populate it with the variables listed below.
5.  Start the development server:
    ```bash
    npm run dev
    ```
    The server will be running on the port specified in your `.env` file (e.g., `http://localhost:3000`).

### Environment Variables
Create a `.env` file in the project root with the following variables:

- `PORT`: The port the server will run on.
  - Example: `PORT=3000`
- `RPC_NETWORK`: The URL for your Starknet RPC node.
  - Example: `RPC_NETWORK=https://starknet-mainnet.public.blastapi.io`
- `OZ_ACCOUNT_CLASS_HASH`: The class hash for the OpenZeppelin account contract you intend to use.
  - Example: `OZ_ACCOUNT_CLASS_HASH=0x025ec026985a3bf9d0cc1fe17326b245dfdc3ff89b8fde106242a3ea56c5a918`
- `ADMIN_ADDRESS`: The Starknet address of the wallet that will fund new accounts.
  - Example: `ADMIN_ADDRESS=0xYourFunderWalletAddressOnStarknet`
- `ADMIN_PRIVATE_KEY`: The private key for the funder wallet.
  - Example: `ADMIN_PRIVATE_KEY=0xYourFunderWalletPrivateKey`
- `ENCRYPTION_SECRET`: A 32-byte (64-character hex string) secret key for encrypting private keys.
  - Example: `ENCRYPTION_SECRET=a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2`

## API Documentation
### Base URL
`http://localhost:3000`

### Endpoints
#### POST /createAccount
**Description**: Generates a new Starknet private/public key pair, calculates the corresponding contract address, and returns public details along with the encrypted private key.

**Request**:
The request body should be empty.
```json
{}
```

**Response**:
A successful response returns the new account's details.
```json
{
    "message": "Account generated successfully",
    "publicKey": "0x5f3e4b7a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8",
    "OZcontractAddress": "0x7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8",
    "encryptedKey": {
        "iv": "e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6",
        "content": "...",
        "tag": "..."
    }
}
```

**Errors**:
- **500 Internal Server Error**: `{ "error": "Failed to create account" }`
  - Occurs if there is an internal issue during key generation or address calculation, or if `OZ_ACCOUNT_CLASS_HASH` or `ENCRYPTION_SECRET` are missing or invalid.

---
#### POST /prefund
**Description**: Transfers a specified amount of STRK tokens from the configured admin wallet to a target address. This is used to provide an initial balance for new accounts to pay for deployment and transaction fees.

**Request**:
The request body must contain the target address and the amount of STRK to send as a string.
```json
{
  "futureAddress": "0x7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8",
  "amount": "0.001"
}
```

**Response**:
A successful response confirms the transaction details.
```json
{
    "message": "STRK Prefund complete",
    "token": "STRK",
    "amount": "0.001",
    "to": "0x7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8",
    "transactionHash": "0x123abcdeffedcba1234567890abcdef1234567890abcdef1234567890abc"
}
```

**Errors**:
- **400 Bad Request**: `{ "error": "Missing required parameters: futureAddress, amount" }`
  - The request body is missing one or both of the required fields.
- **500 Internal Server Error**: `{ "error": "Configuration error: Funder details or RPC URL missing. Check your .env file." }`
  - The server is missing required environment variables (`ADMIN_ADDRESS`, `ADMIN_PRIVATE_KEY`, `RPC_NETWORK`).
- **500 Internal Server Error**: `{ "error": "Prefunding failed", "details": "..." }`
  - The on-chain transaction failed for a specific reason, such as insufficient funds in the admin wallet. The `details` field will contain the error message from the blockchain.

[![Readme was generated by Dokugen](https://img.shields.io/badge/Readme%20was%20generated%20by-Dokugen-brightgreen)](https://www.npmjs.com/package/dokugen)